<div class="container">
  <h1>User Management</h1>

  @if (error) {
    <div class="error">{{ error }}</div>
  }

  @if (loading) {
    <p>Loading...</p>
  } @else {
    <table>
      <thead>
        <tr>
          <th>Email</th>
          <th>Name</th>
          <th>Role</th>
          <th>Status</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        @for (user of users; track user.id) {
          <tr>
            <td>{{ user.email }}</td>
            <td>{{ user.name || '-' }}</td>
            <td>{{ user.role || 'user' }}</td>
            <td>
              @if (user.banned) {
                <span class="badge banned">Banned</span>
              } @else if (user.emailVerified) {
                <span class="badge active">Active</span>
              } @else {
                <span class="badge unverified">Unverified</span>
              }
            </td>
            <td>
              <button (click)="openModal('role', user)">Role</button>
              @if (user.banned) {
                <button (click)="unbanUser(user.id)">Unban</button>
              } @else {
                <button (click)="openModal('ban', user)">Ban</button>
              }
              <button (click)="deleteUser(user.id)" class="danger">Delete</button>
            </td>
          </tr>
        }
      </tbody>
    </table>
  }
</div>

@if (showModal && selectedUser) {
  <div class="modal-overlay" (click)="closeModal()">
    <div class="modal" (click)="$event.stopPropagation()">
      @if (modalType === 'ban') {
        <h2>Ban User</h2>
        <p>{{ selectedUser.email }}</p>
        <label>
          Reason
          <input type="text" [(ngModel)]="banReason" placeholder="Optional">
        </label>
        <label>
          Days
          <input type="number" [(ngModel)]="banDays" min="1">
        </label>
        <div class="modal-actions">
          <button (click)="banUser()" class="danger">Ban</button>
          <button (click)="closeModal()">Cancel</button>
        </div>
      } @else if (modalType === 'role') {
        <h2>Change Role</h2>
        <p>{{ selectedUser.email }}</p>
        <label>
          Role
          <select [(ngModel)]="newRole">
            <option value="user">User</option>
            <option value="moderator">Moderator</option>
            <option value="admin">Admin</option>
          </select>
        </label>
        <div class="modal-actions">
          <button (click)="changeRole()">Save</button>
          <button (click)="closeModal()">Cancel</button>
        </div>
      }
    </div>
  </div>
}
